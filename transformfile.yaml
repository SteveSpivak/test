With(
    {
        // Input Terraform variable block
        terraformVariable: "variable ""base_name"" {\n  type = string\n}",

        // Extract the variable name
        variableName: Mid(
            terraformVariable,
            Find("""", terraformVariable) + 1,
            Find("""", Mid(terraformVariable, Find("""", terraformVariable) + 1)) - 1
        ),

        // Extract the variable content block
        contentBlock: Mid(
            terraformVariable,
            Find("{", terraformVariable) + 1,
            Find("}", terraformVariable) - Find("{", terraformVariable) - 1
        )
    },
    // Process contentBlock to create JSON
    With(
        {
            // Extract key-value pairs from contentBlock
            keyValuePairs: ForAll(
                Split(contentBlock, Char(10)), // Split by newline
                If(
                    !IsBlank(ThisRecord.Result) && Find("=", ThisRecord.Result) > 0, // Lines with "="
                    {
                        key: Trim(First(Split(ThisRecord.Result, "=")).Result), // Extract key
                        value: Trim(Last(Split(ThisRecord.Result, "=")).Result) // Extract value
                    }
                )
            )
        },
        // Construct JSON result
        "{""" & variableName & """: {" & Concat(
            keyValuePairs,
            """ & ThisRecord.key & """: """ & ThisRecord.value & """",
            ","
        ) & "}}"
    )
)
