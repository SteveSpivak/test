With(
    {
        // Step 1: Input Terraform file content
        terraformFile: "<INSERT TERRAFORM FILE TEXT>",

        // Step 2: Extract variable blocks
        variableBlocks: Filter(
            Split(terraformFile, "variable"),
            Len(Trim(ThisRecord.Value)) > 0 // Exclude empty strings or whitespace
        )
    },
    With(
        {
            // Step 3: Parse each variable block
            parsedVariables: ForAll(
                variableBlocks,
                With(
                    {
                        // Step 4: Current variable block
                        variableText: Trim(ThisRecord.Value),

                        // Step 5: Extract variable name
                        variableName: Mid(
                            variableText,
                            Find("""", variableText) + 1,
                            Find("""", variableText, Find("""", variableText) + 1) - Find("""", variableText) - 1
                        ),

                        // Step 6: Extract content block
                        contentStart: Find("{", variableText),
                        contentEnd: Find("}", variableText, Find("{", variableText)),
                        contentBlock: Mid(
                            variableText,
                            contentStart + 1,
                            contentEnd - contentStart - 1
                        ),

                        // Step 7: Extract default value if present
                        defaultStart: Find("default =", variableText),
                        defaultValue: If(
                            defaultStart > 0,
                            Trim(
                                Mid(
                                    variableText,
                                    defaultStart + 9,
                                    Find("\n", variableText, defaultStart) - defaultStart - 9
                                )
                            ),
                            "null"
                        ),

                        // Step 8: Handle nested types recursively
                        parsedType: If(
                            StartsWith(Trim(contentBlock), "map("),
                            "{""map"": """ & Mid(contentBlock, 5, Len(contentBlock) - 5) & """}",
                            If(
                                StartsWith(Trim(contentBlock), "list("),
                                "{""list"": """ & Mid(contentBlock, 6, Len(contentBlock) - 6) & """}",
                                If(
                                    StartsWith(Trim(contentBlock), "object("),
                                    "{""object"": """ & Mid(contentBlock, 8, Len(contentBlock) - 8) & """}",
                                    contentBlock
                                )
                            )
                        )
                    },
                    // Step 9: Construct JSON object for the variable
                    "{""" & variableName & """: {" &
                        """type"": """ & parsedType & """, " &
                        """default"": """ & defaultValue & """" &
                    "}}"
                )
            )
        },
        // Step 10: Combine all variables into a single JSON object
        "{" & Concat(parsedVariables, ThisRecord.Value & ", ") & "}"
    )
)
